{{- if and .Values.frontend.enabled .Values.frontend.ingress.enabled .Values.frontend.ingress.basicAuth.enabled (not .Values.frontend.ingress.basicAuth.existingSecret) }}
{{- $username := required "frontend.ingress.basicAuth.username is required when generating a basic auth secret" .Values.frontend.ingress.basicAuth.username }}
{{- $password := required "frontend.ingress.basicAuth.password is required when generating a basic auth secret" .Values.frontend.ingress.basicAuth.password }}
{{- $secretName := default (printf "%s-frontend-basic-auth" (include "blockscout-stack.fullname" .)) .Values.frontend.ingress.basicAuth.secretName }}
{{- $existingSecret := lookup "v1" "Secret" .Release.Namespace $secretName }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  labels:
    {{- include "blockscout-stack.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if and $existingSecret $existingSecret.data (index $existingSecret.data "auth") }}
  auth: {{ index $existingSecret.data "auth" }}
  {{- else }}
  auth: {{ htpasswd $username $password | b64enc | quote }}
  {{- end }}
{{- end }}
